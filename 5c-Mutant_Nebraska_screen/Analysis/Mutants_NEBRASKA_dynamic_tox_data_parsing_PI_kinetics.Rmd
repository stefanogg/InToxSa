---
title: 'Homemade and Nebraska mutants dynamic cytotoxicity: parsing PI kinetics data'
author: "R Guerillot"
date: "10/12/2019"
output: html_document
editor_options: 
  chunk_output_type: inline
---

# Set/check knitR option and working directory
```{r setup, include=T}
library(tidyverse)
library(here)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = here())
print(paste("My working directory is:" ,here()))
```

### PI kinetics

## Import raw data, one table at the time

```{r message=FALSE}
source("Functions/all_functions.R")
```

# experiment 191209 plate A n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateA/exp_191209/PI_kinetics/191209 RG plate A infection n1.xlsx"
duration <- c(19, 30)
wavelength <- c(493, 535)

# new variables
exp <- "exp191209"
cell_number <- 4e4
plate <- "A"

# parse results
PI_A1 <- parse_kinetics(file = file, duration = duration, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 191216 plate A n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateA/exp_191216/PI_kinetics/191217 RG plate A infection n2.xlsx"
duration <- c(17, 48)
wavelength <- c(493, 535)

# new variables
exp <- "exp191216"
cell_number <- 4e4
plate <- "A"

# parse results
PI_A2 <- parse_kinetics(file = file, duration = duration, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, n_skip = 13, plot_data = F)
```

# experiment 191212 plate B n=1
```{r message=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateB/exp_191212/PI_kinetics/191212 RG plate B infection n1.xlsx"
duration <- c(22, 42)
wavelength <- c(493, 535)
n_skip = 13

# new variables
exp <- "exp191212"
cell_number <- 4e4
plate <- "B"

# parse results
PI_B1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 191213 plate C n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateC/exp_191213/PI_kinetics/191213 RG plate C infection n1.xlsx"
duration <- c(24, 54)
wavelength <- c(493, 535)
n_skip = 13

# new variables
exp <- "exp191213"
cell_number <- 4e4
plate <- "C"

# parse results
PI_C1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 191219 plate C n=2

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateC/exp_191219/PI_kinetics/191219 RG plate C infection n2.xlsx"
duration <- c(23, 06)
wavelength <- c(493, 535)
n_skip = 13

# new variables
exp <- "exp191219"
cell_number <- 4e4
plate <- "C"

# parse results
PI_C2 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 191220 plate D n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateC/exp_191213/PI_kinetics/191213 RG plate C infection n1.xlsx"
duration <- c(24, 54)
wavelength <-  c(493, 535)
n_skip = 13

# new variables
exp <- "exp191220"
cell_number <- 4e4
plate <- "D"

# parse results
PI_D1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 200122 plate E n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateE/exp_200122/PI_kinetics/PlateE_PI.xlsx"
duration <- c(22, 54)
wavelength <- 540 # !!! different waqvelength used
keep_wavelength = 540
n_skip = 13

# new variables
exp <- "exp200122"
cell_number <- 4e4
plate <- "E"

# parse results
PI_E1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, keep_wavelength = keep_wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = T)

```

# Need to filter reading errors >200000
```{r}
PI_E1 <- PI_E1 %>% 
  filter(f_signal < 200000)

quick_plot(PI_E1)
```

# experiment 200203 plate E n=2 72h

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateE/exp_200203_72h/PI_kinetics/20200203 RG plate E infection n2 72 hours.xlsx"
duration <- c(68, 12)
wavelength <-  c(493, 535)
n_skip = 14

# new variables
exp <- "exp200203"
cell_number <- 4e4
plate <- "E"

# parse results
PI_E2 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = T)

```
# Need to filter reading errors >200000
```{r}
PI_E2 <- PI_E2 %>% 
  filter(f_signal < 40000)

quick_plot(PI_E2)

PI_E2 <- PI_E2 %>%
  filter(!(well %in% c("E08", "E06", "D08")))

quick_plot(PI_E2)
```

# experiment 200212 plate F n=1 48h

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateF/exp_200212/PI_kinetics/200212 RG plate F infection n1 48 hours.xlsx"
duration <- c(42, 00)
wavelength <-  c(493, 535)
n_skip = 13

# new variables
exp <- "exp200212"
cell_number <- 4e4
plate <- "F"

# parse results
PI_F1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = T)

```


# combine raw data and merge with well and strain info (strain name etc)

```{r}
well_info_df <- read.csv("Mutant_Nebraska_screen/Plate_info/well_info.csv")
strain_info_df <- read.csv("Mutant_Nebraska_screen/Plate_info/strain_info.csv")

cell_death_df <- dplyr::left_join(x = rbind(PI_A1,
                                            PI_A2,
                                            PI_B1,
                                            PI_C1,
                                            PI_C2,
                                            PI_D1,
                                            PI_E1,
                                            PI_E2,
                                            PI_F1), 
                                  y= well_info_df, 
                                  by = c("well","plate")) %>%
  left_join(., strain_info_df, by = "sample_id")

```

# fix sample ID of SSR mutants
```{r}
cell_death_df <- cell_death_df %>%
  mutate(sample_id = ifelse(strain_group %in% c("SSR-ST5","SSR-ST8"), yes = as.character(strain_description), no = sample_id))
```

# check infection plate E 72h (exp200203)

```{r fig.height=30, fig.width=30}
plot_cell_death(cell_death_df %>%
                  filter(experiment == "exp200203") %>%
                  fit_smooth_spline(.), 
                standardized = F, 
                fitted = T, 
                all_replicates = 120, 
                combine_experiments = "all",
                comparator = "JE2",
                annotate = T)
```

# check infection plate F 48h (exp200212)

```{r fig.height=30, fig.width=30, message=FALSE, warning=FALSE}
plot_cell_death(cell_death_df %>%
                  filter(experiment == "exp200212") %>%
                  fit_smooth_spline(.), 
                standardized = F, 
                fitted = T, 
                all_replicates = 120, 
                combine_experiments = "all",
                comparator = "JE2",
                annotate = T)
```

# standardise according to JE2 an cut experiment duration to the shortest experiment
```{r fig.height=30, fig.width=21}
cell_death_std_df <- JE2_POMS_standardisation(cell_death_df,
                                              cut = T, # cut the experiment duration to the length of the shortest experiment
                                              plot = F)
```

# plot PI kinetics all replicates combined and identify outliers
```{r fig.height=60, fig.width=21}
plot_cell_death(df = cell_death_std_df, 
                fitted = F, 
                standardized = T, 
                combine_experiments = "all", 
                annotate = T,
                all_replicates = 24) # plot measure every 12 min only
```

# outliers have been identified and well_id saved in the csv file below: 
```{r}
PI_kinetics_outliers_Nebraska <- read.csv("~/Documents/Github/Travail/Abdou_project/Staph_infection_project/github_analysis/VANANZ_phenotypes/Mutant_Nebraska_screen/Raw_data/PI_kinetics_outliers_Nebraska.csv", sep="", stringsAsFactors=FALSE) %>%
  merge(., cell_death_df, by.x = "PI_kinetic_outliers", by.y = "well_id", all.x = T) %>%
  filter(!duplicated(PI_kinetic_outliers))

PI_kinetics_outliers_Nebraska
```

# identify wells that are repeteadly problematic
```{r}
count(PI_kinetics_outliers_Nebraska, well) %>% arrange(-n)
```

# remove problematic wells G10, G11, G12 and JE2 outliers from raw data
```{r}
cell_death_clean_df <- cell_death_df %>%
  filter(!(well %in% c("G10", "G11", "G12"))) %>% # filter problematic wells
  filter(!(well_id %in% (PI_kinetics_outliers_Nebraska %>% # filter JE2 outliers 
             filter(sample_id == "JE2") %>% 
             .$PI_kinetic_outliers)))
#PI_kinetics_outliers_Nebraska <- PI_kinetics_outliers_Nebraska$PI_kinetic_outliers
```

# We need to re-standardise wthout JE2 outliers
```{r fig.height=30, fig.width=21}
cell_death_clean_std_df <- JE2_POMS_standardisation(cell_death_clean_df, plot = F)
```

# fit smooth spline model to each well reading with broom/tidyverse
```{r}
cell_death_clean_std_fit_df <- fit_smooth_spline(cell_death_clean_std_df)
```

# synchronised experiments using JE2 as reference
```{r fig.height=60, fig.width=21}
#FIXME
#cell_death_clean_std_fit_df <- sync_experiments(cell_death_clean_std_fit_df)
#plot_cell_death(df = cell_death_clean_std_fit_df, sync = T, fitted = T, combine_experiments = T, all_replicates = 24)

```

# plot fit smooth spline for each well
```{r}
plot_cell_death(df = cell_death_clean_std_fit_df,
                all_replicates = 24, 
                fitted = T)
```

# plot model residuals
```{r}
plot_cell_death(df = cell_death_clean_std_fit_df, residual = T, all_replicates = 24)
```

# plot 1st derivative (cell death rate)
```{r}
plot_cell_death(df= cell_death_clean_std_fit_df, derivative1 = T, all_replicates = 24)
```

# plot 2nd derivative
```{r}
plot_cell_death(df= cell_death_clean_std_fit_df, derivative2 = T, all_replicates = 24)
```

# plot combined fitted results
```{r fig.height=60, fig.width=21}
plot_cell_death(df = cell_death_clean_std_fit_df, fitted = T,  all_replicates = 24, combine_experiments = "all", annotate = T)
```

# Plot nebraska compared with JE2
```{r fig.height=60, fig.width=21}
NEBRASKA_df <- cell_death_clean_std_fit_df %>%
  filter(sample_id != "Maximum cell death") %>%
  filter(strain_group == "NEBRASKA" | strain_group == "CONTROL") 
plot_cell_death(df = NEBRASKA_df, fitted = T, combine_experiments = "all", comparator = "JE2", all_replicates = 24)
```

# Plot SSR-ST5 compared with wild type BPH2819 (LAD-68)
```{r fig.height=10, fig.width=21}
SSR_ST5_df <- cell_death_clean_std_fit_df %>%
  filter(sample_id != "Maximum cell death") %>%
  #filter(plate == "A") %>%
  filter(strain_group == "SSR-ST5" | strain_group == "CONTROL")  %>%
  mutate(sample_id  = strain_description)
plot_cell_death(df = SSR_ST5_df, fitted = T, combine_experiments = "all", comparator = "WT ST5", all_replicates = 24)
```

# Plot SSR-ST8 compared with wild type BPH2986 (LAD-67)
```{r fig.height=10, fig.width=21}
SSR_ST8_df <- cell_death_clean_std_fit_df %>%
  filter(sample_id != "Maximum cell death") %>%
  #filter(plate == "A") %>%
  filter(strain_group == "SSR-ST8" | strain_group == "CONTROL") %>%
  mutate(sample_id  = strain_description)
plot_cell_death(df = SSR_ST8_df, fitted = T, combine_experiments = "all", comparator = "WT ST8", sync = F, all_replicates = 24)
```

# Plot BOR-01 compared with index isolate AUS0325
```{r fig.height=10, fig.width=21}
BOR1_df <- cell_death_clean_std_fit_df %>%
  filter(sample_id != "Maximum cell death") %>%
  filter(plate == "A") %>%
  filter(strain_group == "BOR-01" | strain_group == "CONTROL") 
plot_cell_death(df = BOR1_df, fitted = T, combine_experiments = "all", comparator = "AUS0325", all_replicates = 24)
```

# Plot BOR-02 compared with index isolate 2014-21162
```{r fig.height=10, fig.width=21}
BOR2_df <- cell_death_clean_std_fit_df %>%
  filter(sample_id != "Maximum cell death") %>%
  filter(plate == "A") %>%
  filter(strain_group == "BOR-02" | strain_group == "CONTROL") 
plot_cell_death(df = BOR2_df, fitted = T, combine_experiments = "all", comparator = "2014-21162", all_replicates = 24)
```

# extract growth parameter of smooth spline model with grofit 
```{r}
cell_death_parameters <- get_parameters(cell_death_clean_std_fit_df)
cell_death_parameters
```

# Check linear correlation between parameters
```{r}
cor <- cor(cell_death_parameters[2:8], cell_death_parameters[2:8], method = "pearson")
corrplot::corrplot(cor, addCoef.col = "white", number.cex = .7, tl.col = "black")
```

# Check rank correlation between parameters
```{r}
cor <- cor(cell_death_parameters[2:8], cell_death_parameters[2:8], method = "spearman")
corrplot::corrplot(cor, addCoef.col = "white", number.cex = .7, tl.col = "black")
```

# plot growth parameter NEBRASKA
```{r fig.height=20, fig.width=10}

library(ggpubr)
p <- ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA")%>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death_rate", 
          x = "sample_id", 
          color = "sample_id",
          add = "point") +
          #geom_point(aes(colour = experiment)) +
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")
p
t <- ggplot_build(p)$data[[1]]

head(t)
head(cell_death_parameters)

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA")%>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA") %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA") %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA") %>%
            filter(sample_id != "Maximum cell death"), 
          y = "AUC", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")
```


# plot growth parameter SSR-ST8
```{r}
ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8")%>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "AUC", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")
```

# plot growth parameter SSR-ST5
```{r}
ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5")%>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "AUC", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")
```


# extract signigicant changes considering all experiment/plate together
```{r}
parameters_stat_NEBRASKA.df <- cell_death_parameters %>%
  filter(strain_group == "NEBRASKA" | sample_id == "JE2") %>%
  get_parameters_stat(.)

parameters_stat_ST8.df <- cell_death_parameters %>%
  filter(strain_group == "SSR-ST8") %>%
  mutate(sample_id = strain_description) %>%
  get_parameters_stat(ref = "WT ST8")

parameters_stat_ST5.df <- cell_death_parameters %>%
  filter(strain_group == "SSR-ST5") %>%
  mutate(sample_id = strain_description) %>%
  get_parameters_stat(ref = "WT ST5") 

parameters_stat_BOR1.df <- cell_death_parameters %>%
  filter(strain_group == "BOR-01") %>%
  mutate(sample_id = strain_description) %>%
  get_parameters_stat(ref = "AUS0325") 

parameters_stat_BOR2.df <- cell_death_parameters %>%
  filter(strain_group == "BOR-02") %>%
  mutate(sample_id = strain_description) %>%
  get_parameters_stat(ref = "2014-21162")

parameters_stat_all.df <- rbind(
  parameters_stat_NEBRASKA.df,
  parameters_stat_ST8.df,
  parameters_stat_ST5.df,
  parameters_stat_BOR1.df,
  parameters_stat_BOR2.df)

parameters_stat_all_p0.005.df <- parameters_stat_all.df %>% filter(p<0.005)

count(parameters_stat_all.df %>% filter(p<0.005), sample_id, tested_parameter) %>%
  arrange(-n) 

count(parameters_stat_all.df, tested_parameter) %>%
  arrange(-n)
```

# plot samples with significantly different parameter p<0.005
```{r fig.height=30, fig.width=20}
plot_cell_death(cell_death_clean_std_fit_df %>% 
                  filter(sample_id %in% c(parameters_stat_NEBRASKA.df %>% filter(p<0.005) %>% .$sample_id) | 
                           sample_id == "JE2"), 
                fitted = T, 
                comparator = "JE2",
                combine_experiments = "all",
                annotate = F,
                ncol = 4
                )

```

# Best significant Nebraska candidate after checking plot
Based on plot these mutants will be excluded:
- NE1531
- NE354
- NE822

```{r fig.height=15, fig.width=15}
best_toxicity_candidate <- parameters_stat_NEBRASKA.df %>% 
  filter(p<0.005) %>%
  filter(!(sample_id %in% c("NE1531", "NE354", "NE822")))

plot_cell_death(cell_death_clean_std_fit_df %>% 
                  filter(sample_id %in% c(best_toxicity_candidate$sample_id) | sample_id == "JE2") %>%
                  mutate(sample_id = paste(sample_id, strain_description)), 
                fitted = T, 
                comparator = "JE2 JE2",
                combine_experiments = "all",
                annotate = F,
                ncol = 2
                )

```

# select samples to repeat
```{r fig.height=30, fig.width=20}
plateE_isolates <- read_csv("Mutant_Nebraska_screen/Plate_info/well_info_plateE.csv")

non_yet_selected <- parameters_stat_all.df %>%
  filter(!(sample_id %in% unique(plateE_isolates$sample_id)))

non_yet_selected


unique(non_yet_selected$sample_id)
unique(parameters_stat_all.df$sample_id)

plot_cell_death(cell_death_clean_std_fit_df %>% 
                  filter(sample_id %in% non_yet_selected$sample_id | 
                           sample_id == "JE2"), 
                fitted = T, 
                comparator = "JE2",
                combine_experiments = "all"
                )
```

# analyse CFU
```{r fig.height=30, fig.width=30}
CFU_df <- read.csv("Mutant_Nebraska_screen/Raw_data/CFUs/all_CFUs.csv") %>%
  mutate(well_id = paste(experiment, well, "plate", plate, trial))


ggboxplot(data = CFU_df %>%
            filter(lysis_method == "water"), 
          y = "after.1", 
          x = "sample_id") + 
          #color = "strain_group") + 
  coord_flip() +
  geom_point() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif",
                     )
  #facet_wrap(~experiment, scales = "free")


CFU_res_df <- compare_means(formula =  after.1 ~ sample_id, 
                           data = CFU_df, 
                           ref.group = "JE2", 
                           method = "wilcox.test") 
```
LAD-61
LAD-47
NE29
NE346
NE432
NE286
NE896
NE81




