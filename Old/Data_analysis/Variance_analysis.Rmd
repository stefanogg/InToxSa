---
title: "Variance_analysis_VANANZ"
author: "R Guerillot"
date: "07/03/2020"
output: html_document
---

# Set/check knitR option and working directory
```{r setup, include=T}
library(tidyverse)
library(here)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = here())
print(paste("My working directory is:" ,here()))
```

# import/normalise/fit PI data
```{r}
source("Functions/all_functions.R")

all_PI.df <- read.csv("Data_parsing/dataframes/partial_datasets/all_PI_kinetics_well_info.csv") %>%
  JE2_POMS_standardisation(.) %>%
  fit_smooth_spline(.)

```

# Calculating f_signal sd and mad for each sample across experiment and globally using standardised or raw data
```{r}
  
all_PI_exp_sd.df <- all_PI.df %>%
  group_by(experiment, sample_id, timepoint) %>%
  mutate(exp_raw_sd = sd(f_signal), exp_raw_mad = mad(f_signal)) %>%
  mutate(exp_std_sd = sd(f_signal.std), exp_std_mad = mad(f_signal.std)) %>%
  ungroup()

all_PI_global_sd.df <-all_PI.df %>%
  group_by(sample_id, timepoint) %>%
  mutate(raw_sd = sd(f_signal), raw_mad = mad(f_signal)) %>%
  mutate(std_sd = sd(f_signal.std), std_mad = mad(f_signal.std)) %>%
  ungroup()

```

# Plotting JE2 standard deviation
```{r}
ggplot(all_PI_exp_sd.df %>% filter(sample_id == "JE2"), aes(y = exp_std_sd)) +
  geom_boxplot() +
  coord_flip()
```

# Plotting JE2 standard deviation of each experiment
Before standardisation:
```{r}
ggplot(all_PI_exp_sd.df %>% filter(sample_id == "JE2"), aes(x = experiment, y = exp_raw_sd, fill = as.factor(plate))) +
  geom_boxplot() +
  coord_flip()
```
After standardisation:
```{r}
ggplot(all_PI_exp_sd.df %>% filter(sample_id == "JE2"), aes(x = experiment, y = exp_std_sd, fill = as.factor(plate))) +
  geom_boxplot() +
  geom_jitter() +
  coord_flip()
```

# Plotting standard deviation within each experiment
Before standardisation:
```{r}
ggplot(all_PI_exp_sd.df, aes(x = experiment, y = exp_raw_sd, fill = as.factor(plate))) +
  geom_boxplot() +
  coord_flip()
```
After standardistaion:
```{r}
ggplot(all_PI_exp_sd.df, aes(x = experiment, y = exp_std_sd,fill = as.factor(plate))) +
  geom_boxplot() +
  coord_flip()
```

# Plotting standard deviation globally
Before + after standardisation:
```{r}
ggplot(all_PI_global_sd.df, aes(x = as.factor(plate), y = raw_sd, fill = as.factor(plate))) +
  geom_boxplot() +
  coord_flip()

ggplot(all_PI_global_sd.df, aes(x = as.factor(plate), y = std_sd, fill = as.factor(plate))) +
  geom_boxplot() +
  coord_flip()
```

# Plotting standard deviation per well globally
Before + after standardisation:
```{r fig.height=30, fig.width=10}

ggplot(all_PI_global_sd.df, aes(x = as.factor(well), y = std_sd)) +
  geom_boxplot() +
  coord_flip()
```
# Plotting standard deviation globally
Before + after standardisation:
```{r}
ggplot(all_PI_global_sd.df, aes(y = std_sd)) +
  geom_boxplot() 

```
# Plotting standard deviation globally across timepoint
Before + after standardisation:
```{r}
ggplot(all_PI_global_sd.df, aes(x = as.factor(timepoint), y = raw_sd)) +
  geom_boxplot() 

ggplot(all_PI_global_sd.df, aes(x = as.factor(timepoint), y = std_sd)) +
  geom_boxplot() 

ggplot(all_PI_global_sd.df, aes(x = as.factor(timepoint), y = std_sd)) +
  geom_boxplot() +
  facet_wrap(~plate, ncol = 2)

```