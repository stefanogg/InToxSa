---
title: 'Homemade and Nebraska mutants dynamic cytotoxicity: parsing PI kinetics data'
author: "R Guerillot"
date: "10/12/2019"
output: html_document
editor_options: 
  chunk_output_type: inline
---

# Set/check knitR option and working directory
```{r setup, include=T}
library(tidyverse)
library(here)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = here())
print(paste("My working directory is:" ,here()))
```

### PI kinetics

## Import raw data, one table at the time

```{r message=FALSE}
source("Functions/all_functions.R")
```

# experiment 191209 plate A n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateA/exp_191209/PI_kinetics/191209 RG plate A infection n1.xlsx"
duration <- c(19, 30)
wavelength <- c(493, 535)

# new variables
exp <- "exp191209"
cell_number <- 4e4
plate <- "A"

# parse results
PI_A1 <- parse_kinetics(file = file, duration = duration, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 191216 plate A n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateA/exp_191216/PI_kinetics/191217 RG plate A infection n2.xlsx"
duration <- c(17, 48)
wavelength <- c(493, 535)

# new variables
exp <- "exp191216"
cell_number <- 4e4
plate <- "A"

# parse results
PI_A2 <- parse_kinetics(file = file, duration = duration, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, n_skip = 13, plot_data = F)
```

# experiment 191212 plate B n=1
```{r message=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateB/exp_191212/PI_kinetics/191212 RG plate B infection n1.xlsx"
duration <- c(22, 42)
wavelength <- c(493, 535)
n_skip = 13

# new variables
exp <- "exp191212"
cell_number <- 4e4
plate <- "B"

# parse results
PI_B1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 191213 plate C n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateC/exp_191213/PI_kinetics/191213 RG plate C infection n1.xlsx"
duration <- c(24, 54)
wavelength <- c(493, 535)
n_skip = 13

# new variables
exp <- "exp191213"
cell_number <- 4e4
plate <- "C"

# parse results
PI_C1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 191219 plate C n=2

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateC/exp_191219/PI_kinetics/191219 RG plate C infection n2.xlsx"
duration <- c(23, 06)
wavelength <- c(493, 535)
n_skip = 13

# new variables
exp <- "exp191219"
cell_number <- 4e4
plate <- "C"

# parse results
PI_C2 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 191220 plate D n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateC/exp_191213/PI_kinetics/191213 RG plate C infection n1.xlsx"
duration <- c(24, 54)
wavelength <-  c(493, 535)
n_skip = 13

# new variables
exp <- "exp191220"
cell_number <- 4e4
plate <- "D"

# parse results
PI_D1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = F)
```

# experiment 200122 plate E n=1

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateE/exp_200122/PI_kinetics/PlateE_PI.xlsx"
duration <- c(22, 54)
wavelength <- 540 # !!! different waqvelength used
keep_wavelength = 540
n_skip = 13

# new variables
exp <- "exp200122"
cell_number <- 4e4
plate <- "E"

# parse results
PI_E1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, keep_wavelength = keep_wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = T)

```

# Need to filter reading errors >200000
```{r}
PI_E1 <- PI_E1 %>% 
  filter(f_signal < 200000)

quick_plot(PI_E1)
```

# experiment 200203 plate E n=2 72h

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateE/exp_200203_72h/PI_kinetics/20200203 RG plate E infection n2 72 hours.xlsx"
duration <- c(68, 12)
wavelength <-  c(493, 535)
n_skip = 14

# new variables
exp <- "exp200203"
cell_number <- 4e4
plate <- "E"

# parse results
PI_E2 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = T)

```
# Need to filter reading errors >200000
```{r}
PI_E2 <- PI_E2 %>% 
  filter(f_signal < 40000)

quick_plot(PI_E2)

PI_E2 <- PI_E2 %>%
  filter(!(well %in% c("E08", "E06", "D08")))

quick_plot(PI_E2)
```

# experiment 200212 plate F n=1 48h

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateF/exp_200212/PI_kinetics/200212 RG plate F infection n1 48 hours.xlsx"
duration <- c(42, 00)
wavelength <-  c(493, 535)
n_skip = 13

# new variables
exp <- "exp200212"
cell_number <- 4e4
plate <- "F"

# parse results
PI_F1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = T)

```

# experiment 200315 plate G n=1 24h

```{r message=FALSE, warning=FALSE}
# arguments for parse function
file <- "Mutant_Nebraska_screen/Raw_data/plateG/exp_200315/PI_kinetics/200315 Plate RG G n1 HeLa 40000 cell death assay 24h.xlsx"
duration <- c(23, 48)
wavelength <-  c(493, 535)
n_skip = 13

# new variables
exp <- "exp200315"
cell_number <- 4e4
plate <- "G"

# parse results
PI_G1 <- parse_kinetics(file = file, duration = duration, n_skip = n_skip, wavelength = wavelength, exp = exp, cell_number = cell_number, plate = plate, plot_data = T)

```


# combine raw data and merge with well and strain info (strain name etc)

```{r}
well_info_df <- read.csv("Mutant_Nebraska_screen/Plate_info/well_info.csv")
strain_info_df <- read.csv("Mutant_Nebraska_screen/Plate_info/strain_info.csv")

cell_death_raw_df <- dplyr::left_join(x = rbind(PI_A1,
                                            PI_A2,
                                            PI_B1,
                                            PI_C1,
                                            PI_C2,
                                            PI_D1,
                                            PI_E1,
                                            PI_E2,
                                            PI_F1,
                                            PI_G1), 
                                  y= well_info_df, 
                                  by = c("well","plate")) %>%
  left_join(., strain_info_df, by = "sample_id")

```

# fix sample ID of SSR mutants
```{r}
cell_death_raw_df <- cell_death_raw_df %>%
  mutate(sample_id = ifelse(strain_group %in% c("SSR-ST5","SSR-ST8"), yes = as.character(strain_description), no = sample_id))
```

# Check JE2 outliers
```{r}
cell_death_JE2_check.df <- cell_death_raw_df %>%
  check_reference()

JE2_outliers <- cell_death_JE2_check.df %>%
  filter(outlier_curve) %>%
  .$well_id %>%
  unique() %>%
  as.character()

JE2_outliers
```

# Remove JE2 outliers from dataset

```{r}
cell_death_df <- cell_death_raw_df %>%
  filter(!well_id %in% JE2_outliers)
```

# Standardise, fit curves and detect outliers
```{r}
cell_death_clean_df <- cell_death_df %>%
  standardise_curves() %>%
  fit_curves() %>%
  flag_outlier_curves(plot = F)

outliers <- cell_death_clean_df %>%
  filter(outlier_curve) %>%
  .$well_id %>%
  as.character() %>%
  unique()

```


# Plot nebraska compared with JE2
```{r fig.height=60, fig.width=21}
NEBRASKA_df <- cell_death_clean_df %>%
  filter(sample_id != "Maximum cell death") %>%
  filter(strain_group == "NEBRASKA" | strain_group == "CONTROL") 


plot_cell_death(df = NEBRASKA_df, fitted = T, combine_experiments = "all", comparator = "JE2", all_replicates = 24, highlight_well1 = NEBRASKA_df$outlier_curve == outliers)
```

# Plot plate G
```{r}
plot_cell_death(df = NEBRASKA_df %>% filter(plate == "G"), fitted = T, combine_experiments = "all", comparator = "JE2", all_replicates = 24, highlight_well1 = outliers)
```

# Plot plate G without outlier
```{r}
plot_cell_death(df = NEBRASKA_df %>% filter(plate == "G") %>% filter(!outlier_curve), fitted = T, combine_experiments = "all", comparator = "JE2", all_replicates = 24, highlight_well1 = outliers)
```

# Plot plate G without gene description
```{r}
plot_cell_death(df = NEBRASKA_df %>% filter(plate == "G") %>% filter(!outlier_curve) %>% mutate(sample_id = paste(strain_description, sample_id)), fitted = T, combine_experiments = "all", comparator = "JE2", all_replicates = 24, highlight_well1 = outliers)
```

# Plot NE896
```{r}
plot_cell_death(df = NEBRASKA_df %>% filter(sample_id %in% c("NE896", "JE2")), fitted = T, combine_experiments = "all", comparator = "JE2", all_replicates = 24, highlight_well1 = outliers)
```



# Plot SSR-ST5 compared with wild type BPH2819 (LAD-68)
```{r fig.height=10, fig.width=21}
SSR_ST5_df <- cell_death_df_2 %>%
  filter(sample_id != "Maximum cell death") %>%
  #filter(plate == "A") %>%
  filter(strain_group == "SSR-ST5" | strain_group == "CONTROL")  %>%
  mutate(sample_id  = strain_description)
plot_cell_death(df = SSR_ST5_df, fitted = T, combine_experiments = "all", comparator = "WT ST5", all_replicates = 24)
```

# Plot SSR-ST8 compared with wild type BPH2986 (LAD-67)
```{r fig.height=10, fig.width=21}
SSR_ST8_df <- cell_death_df_2 %>%
  filter(sample_id != "Maximum cell death") %>%
  #filter(plate == "A") %>%
  filter(strain_group == "SSR-ST8" | strain_group == "CONTROL") %>%
  mutate(sample_id  = strain_description)
plot_cell_death(df = SSR_ST8_df, fitted = T, combine_experiments = "all", comparator = "WT ST8", sync = F, all_replicates = 24)
```

# Plot BOR-01 compared with index isolate AUS0325
```{r fig.height=10, fig.width=21}
BOR1_df <- cell_death_df_2 %>%
  filter(sample_id != "Maximum cell death") %>%
  filter(plate == "A") %>%
  filter(strain_group == "BOR-01" | strain_group == "CONTROL") 
plot_cell_death(df = BOR1_df, fitted = T, combine_experiments = "all", comparator = "AUS0325", all_replicates = 24)
```

# Plot BOR-02 compared with index isolate 2014-21162
```{r fig.height=10, fig.width=21}
BOR2_df <- cell_death_df_2 %>%
  filter(sample_id != "Maximum cell death") %>%
  filter(plate == "A") %>%
  filter(strain_group == "BOR-02" | strain_group == "CONTROL") 
plot_cell_death(df = BOR2_df, fitted = T, combine_experiments = "all", comparator = "2014-21162", all_replicates = 24)
```

# extract growth parameter of smooth spline model with grofit 
```{r}
cell_death_parameters <- get_parameters(cell_death_df_2)
cell_death_parameters
```

# Check linear correlation between parameters
```{r}
cor <- cor(cell_death_parameters[2:8], cell_death_parameters[2:8], method = "pearson")
corrplot::corrplot(cor, addCoef.col = "white", number.cex = .7, tl.col = "black")
```

# Check rank correlation between parameters
```{r}
cor <- cor(cell_death_parameters[2:8], cell_death_parameters[2:8], method = "spearman")
corrplot::corrplot(cor, addCoef.col = "white", number.cex = .7, tl.col = "black")
```

# plot growth parameter NEBRASKA
```{r fig.height=20, fig.width=10}

library(ggpubr)
ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA")%>%
          filter(sample_id != "Maximum cell death"), 
          y = "max_death_rate", 
          x = "sample_id", 
          color = "strain_group",
          add = "point") +
          #geom_point(aes(colour = experiment)) +
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA")%>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA") %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA") %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "CONTROL" | strain_group == "NEBRASKA") %>%
            filter(sample_id != "Maximum cell death"), 
          y = "AUC", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "JE2", 
                     method = "wilcox.test",
                     label = "p.signif")
```


# plot growth parameter SSR-ST8
```{r}
ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8")%>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST8") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "AUC", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST8", 
                     method = "wilcox.test",
                     label = "p.signif")
```

# plot growth parameter SSR-ST5
```{r}
ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5")%>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death_rate", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "time_of_max_death", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")

ggboxplot(data = cell_death_parameters %>% filter(strain_group == "SSR-ST5") %>%
            mutate(sample_id = strain_description) %>%
            filter(sample_id != "Maximum cell death"), 
          y = "AUC", 
          x = "sample_id", 
          color = "strain_group") + 
  coord_flip() +
  stat_compare_means(ref.group = "WT ST5", 
                     method = "wilcox.test",
                     label = "p.signif")
```


# extract signigicant changes considering all experiment/plate together
```{r}
parameters_stat_NEBRASKA.df <- cell_death_parameters %>%
  filter(strain_group == "NEBRASKA" | sample_id == "JE2") %>%
  get_parameters_stat(.)

parameters_stat_ST8.df <- cell_death_parameters %>%
  filter(strain_group == "SSR-ST8") %>%
  mutate(sample_id = strain_description) %>%
  get_parameters_stat(ref = "WT ST8")

parameters_stat_ST5.df <- cell_death_parameters %>%
  filter(strain_group == "SSR-ST5") %>%
  mutate(sample_id = strain_description) %>%
  get_parameters_stat(ref = "WT ST5") 

parameters_stat_BOR1.df <- cell_death_parameters %>%
  filter(strain_group == "BOR-01") %>%
  mutate(sample_id = strain_description) %>%
  get_parameters_stat(ref = "AUS0325") 

parameters_stat_BOR2.df <- cell_death_parameters %>%
  filter(strain_group == "BOR-02") %>%
  mutate(sample_id = strain_description) %>%
  get_parameters_stat(ref = "2014-21162")

parameters_stat_all.df <- rbind(
  parameters_stat_NEBRASKA.df,
  parameters_stat_ST8.df,
  parameters_stat_ST5.df,
  parameters_stat_BOR1.df,
  parameters_stat_BOR2.df)

parameters_stat_all_p0.005.df <- parameters_stat_all.df %>% filter(p<0.005)

count(parameters_stat_all.df %>% filter(p<0.005), sample_id, tested_parameter) %>%
  arrange(-n) 

count(parameters_stat_all.df, tested_parameter) %>%
  arrange(-n)
```

# plot samples with significantly different parameter p<0.005
```{r}
plot_cell_death(cell_death_df_2 %>% 
                  filter(sample_id %in% c(parameters_stat_NEBRASKA.df %>% filter(p<0.05)%>% .$sample_id) | 
                           sample_id == "JE2"), 
                fitted = T, 
                comparator = "JE2",
                combine_experiments = "all",
                annotate = F,
                all_replicates = 24,
                ncol = 4,
                standardized = F
                )

```

plot_cell_death(cell_death_df_2 %>% 
                  filter(sample_id %in% c(parameters_stat_NEBRASKA.df %>% filter(p<0.05)%>% .$sample_id) | 
                           sample_id == "JE2"), 
                fitted = T, 
                comparator = "JE2",
                combine_experiments = "all",
                annotate = F,
                all_replicates = 24,
                ncol = 4,
                standardized = F
                )

# Post-infection CFU analysis

# Import CFU counts
```{r}
CFU_df <- read.csv("Mutant_Nebraska_screen/Raw_data/CFUs/all_CFUs.csv") %>%
  mutate(well_id = paste(experiment, well, "plate", plate, trial)) %>%
  mutate(experiment = paste(experiment, infection.duration)) 
  
```

# Filter dried/evaporated wells
```{r}
CFU_df <- read.csv("Mutant_Nebraska_screen/Raw_data/CFUs/all_CFUs.csv") %>%
  filter(to.exclude == "")
```

# Calculate delta CFU post-infection using JE2 as reference 
```{r}
CFU_JE2_df <- CFU_df %>%
  filter(sample_id == "JE2") %>%
  group_by(experiment) %>%
  summarise( JE2_before.3 = round(mean(before.3)), JE2_after_neat = round(mean(after_neat)), JE2_after.1 = round(mean(after.1)))

CFU_df <- merge(CFU_df, CFU_JE2_df, by = "experiment", all.x = T, all.y = F) %>%
  mutate(delta_before.3 = before.3 - JE2_before.3, 
         delta_after_neat = after_neat - JE2_after_neat,
         delta_after.1 = after.1 - JE2_after.1)

select_CFU_plus_df <- CFU_df %>%
  filter(delta_after_neat > 20 | delta_after.1 > 20 )

select_CFU_minus_df <- CFU_df %>%
  filter(delta_after_neat < -10 | delta_after.1 < -10)
```

# plot delta CFU vs JE2
```{r fig.height=50, fig.width=10, message=FALSE, warning=FALSE}
p1<-ggboxplot(data = CFU_df %>%
            filter(lysis_method == "water") %>%
            filter(strain_group == "NEBRASKA"), 
          y = "delta_after.1", 
          x = "sample_id") +
  coord_flip() +
  facet_wrap(~experiment, scale = "free", ncol = 1) +
  geom_point() 

p2<-ggboxplot(data = CFU_df %>%
            filter(lysis_method == "water") %>%
            filter(strain_group == "NEBRASKA"), 
          y = "delta_after_neat", 
          x = "sample_id") +
  coord_flip() +
  facet_wrap(~experiment, scale = "free", ncol = 1) +
  geom_point() 

cowplot::plot_grid(p1,p2)
```

# idem - agrA mutant
```{r fig.height=50, fig.width=10, message=FALSE, warning=FALSE}
p1<-ggboxplot(data = CFU_df %>%
            filter(lysis_method == "water") %>%
            filter(strain_group == "NEBRASKA") %>%
            filter(sample_id != "NEB agrA"),
          y = "delta_after.1", 
          x = "sample_id") +
  coord_flip() +
  facet_wrap(~experiment, scale = "free", ncol = 1) +
  geom_point() 

p2<-ggboxplot(data = CFU_df %>%
            filter(lysis_method == "water") %>%
            filter(strain_group == "NEBRASKA") %>%
            filter(sample_id != "NEB agrA"), 
          y = "delta_after_neat", 
          x = "sample_id") +
  coord_flip() +
  facet_wrap(~experiment, scale = "free", ncol = 1) +
  geom_point() 

cowplot::plot_grid(p1,p2)
```

# idem for non neb mutants
```{r fig.height=50, fig.width=10, message=FALSE, warning=FALSE}
p1<-ggboxplot(data = CFU_df %>%
            filter(lysis_method == "water") %>%
            filter(strain_group != "NEBRASKA") %>%
            filter(sample_id != "NEB agrA"),
          y = "delta_after.1", 
          x = "sample_id") +
  coord_flip() +
  facet_wrap(~experiment, scale = "free", ncol = 1) +
  geom_point() 

p2<-ggboxplot(data = CFU_df %>%
            filter(lysis_method == "water") %>%
            filter(strain_group != "NEBRASKA") %>%
            filter(sample_id != "NEB agrA"), 
          y = "delta_after_neat", 
          x = "sample_id") +
  coord_flip() +
  facet_wrap(~experiment, scale = "free", ncol = 1) +
  geom_point() 

cowplot::plot_grid(p1,p2)
```

# Plot NEBRASKA mutants selected for Elizabel project
```{r}
plot_cell_death(df = cell_death_df_2 %>% filter(sample_id %in% c("NE29", "NE81", "NE89", "NE1686", "NE346", "NE390", "NEB agrA", "JE2")), 
                standardized = T,
                fitted = T,
                combine_experiments = "all",
                all_replicates = F,
                comparator = "JE2",
                ncol = 4,
                save_plot = "Elizabel_NEBRASKA_mutants")
```
